<div class="flex flex-col gap-12">
  <header class="flex flex-col gap-4">
    <p class="text-md text-accent">
      {% if current_category %}
        Категория: {{ current_category_label|default:current_category }}
        {{current_category}}
      {% else %}
        Коллекция Libra Antiqua
      {% endif %}
    </p>
    <h1 class="font-serif text-4xl text-ink">Каталог редких книг</h1>
    <p class="max-w-2xl text-base text-ink-muted">
      Подборка букинистических изданий с сохранённой историей. Используйте фильтры, чтобы найти идеальный экземпляр для вашей коллекции.
    </p>
  </header>

  <div class="grid gap-12 lg:grid-cols-[minmax(0,290px)_1fr]">
    <aside class="space-y-6 rounded-3xl border border-accent-soft/60 bg-white p-6 shadow-lamplight">
      <h2 class="font-serif text-xl text-ink">Подбор по параметрам</h2>
      <form action="." method="get" class="space-y-4">
        <div>
          <label for="q" class="text-xs uppercase tracking-[0.3em] text-ink-muted">Поиск</label>
          <input
            id="q"
            name="q"
            type="text"
            value="{{ filter_params.q|default:search_query }}"
            placeholder="Автор, название или издательство"
            class="mt-2 w-full rounded-xl border border-accent/30 bg-white px-4 py-2 text-sm text-ink placeholder:text-ink-muted/70 focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/30"
          >
        </div>
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-1">
          <div>
            <label for="min_price" class="text-xs uppercase tracking-[0.3em] text-ink-muted">Цена от</label>
            <input
              id="min_price"
              name="min_price"
              type="number"
              value="{{ filter_params.min_price }}"
              min="0"
              class="mt-2 w-full rounded-xl border border-accent/30 bg-white px-4 py-2 text-sm text-ink placeholder:text-ink-muted/70 focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/30"
            >
          </div>
          <div>
            <label for="max_price" class="text-xs uppercase tracking-[0.3em] text-ink-muted">Цена до</label>
            <input
              id="max_price"
              name="max_price"
              type="number"
              value="{{ filter_params.max_price }}"
              min="0"
              class="mt-2 w-full rounded-xl border border-accent/30 bg-white px-4 py-2 text-sm text-ink placeholder:text-ink-muted/70 focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/30"
            >
          </div>
          <div>
            <label for="year" class="text-xs uppercase tracking-[0.3em] text-ink-muted">Год издания</label>
            <input
              id="year"
              name="year"
              type="number"
              value="{{ filter_params.year }}"
              class="mt-2 w-full rounded-xl border border-accent/30 bg-white px-4 py-2 text-sm text-ink placeholder:text-ink-muted/70 focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/30"
            >
          </div>
          <div>
            <label for="author" class="text-xs uppercase tracking-[0.3em] text-ink-muted">Автор</label>
            <input
              id="author"
              name="author"
              type="text"
              value="{{ filter_params.author }}"
              class="mt-2 w-full rounded-xl border border-accent/30 bg-white px-4 py-2 text-sm text-ink placeholder:text-ink-muted/70 focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/30"
            >
          </div>
        </div>
        <div class="flex flex-wrap gap-3">
          <button
            type="submit"
            class="rounded-lg border border-accent-soft bg-accent px-5 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-paper transition hover:bg-accent-soft hover:text-coffee"
          >
            Применить
          </button>
          <a
            href="{% url 'main:catalog_all' %}"
            class="rounded-lg border border-accent-soft px-5 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-accent transition hover:bg-accent-soft/20"
          >
            Сбросить
          </a>
        </div>
      </form>
      {% if genres %}
        <div>
          <h3 class="font-serif text-lg text-ink">Жанры и коллекции</h3>
          <ul class="mt-4 space-y-2 text-sm text-ink-muted">
            {% for genre in genres %}
              <li class="rounded-lg border border-transparent px-3 py-2 transition hover:border-accent hover:text-ink">
                {{ genre.name }}
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </aside>

    <div class="space-y-8">
      {% if search_query %}
        <p class="text-sm text-ink-muted">
          Найдено по запросу
          <span class="font-semibold text-accent">«{{ search_query }}»</span>
        </p>
      {% endif %}
      <div class="grid gap-6 sm:grid-cols-2 xl:grid-cols-3">
        {% for product in products %}
          <article class="group flex flex-col overflow-hidden rounded-2xl border border-accent-soft/60 bg-white shadow-md shadow-coffee/10 transition hover:-translate-y-1 hover:shadow-lamplight">
            <a href="{% url 'main:product_detail' product.slug %}" class="flex flex-1 flex-col">
              <div class="relative aspect-[3/4] overflow-hidden">
                {% if product.main_image %}
                  <img
                    src="{{ product.main_image.url }}"
                    alt="Обложка: {{ product.name }}"
                    class="h-full w-full object-cover transition duration-500 group-hover:scale-105"
                  >
                {% else %}
                  <div class="flex h-full w-full items-center justify-center bg-accent-soft text-ink">
                    Нет изображения
                  </div>
                {% endif %}
                <span class="absolute inset-x-2 top-2 rounded-full bg-coffee/80 px-3 py-1 text-[0.6rem] uppercase tracking-[0.4em] text-paper">
                  Редкое издание
                </span>
              </div>
              <div class="flex flex-1 flex-col gap-3 px-5 py-6">
                <h3 class="font-serif text-xl text-ink">{{ product.name }}</h3>
                {% if product.authors %}
                  <p class="text-sm text-ink-muted">{{ product.authors }}</p>
                {% endif %}
                {% if product.year %}
                  <p class="text-xs uppercase tracking-[0.3em] text-ink-muted">Год: {{ product.year }}</p>
                {% endif %}
                <div class="mt-auto flex items-baseline gap-2">
                  <span class="font-semibold text-accent">{{ product.price }} {{ product.currency }}</span>
                  {% if product.old_price %}
                    <span class="text-sm text-ink-muted line-through">{{ product.old_price }} {{ product.currency }}</span>
                  {% endif %}
                </div>
              </div>
            </a>
          </article>
        {% empty %}
          <div class="col-span-full rounded-3xl border border-accent-soft/60 bg-white p-12 text-center text-ink-muted shadow-lamplight">
            К сожалению, по выбранным параметрам ничего не найдено. Попробуйте изменить условия поиска.
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
