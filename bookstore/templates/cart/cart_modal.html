<div id="cart-modal" class="fixed inset-y-0 right-0 z-50 w-full max-w-lg">
    <div class="flex h-full flex-col bg-white/95 shadow-2xl ring-1 ring-accent-soft/50 backdrop-blur">
        <!-- Cart Header -->
        <div class="flex items-start justify-between gap-4 border-b border-accent-soft/60 px-6 py-5">
            <div>
                <p class="text-sm text-graphite">Ваши книги</p>
                <h1 class="mt-2 text-2xl font-semibold text-ink">
                    Корзина
                    <span class="ml-2 text-sm font-normal text-ink-muted">(<span id="cart-count">{{ cart.total_items }}</span> шт.)</span>
                </h1>
            </div>
            <button
                type="button"
                onclick="hideCartModal()"
                class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-accent-soft text-ink transition hover:border-accent hover:text-accent"
                aria-label="Закрыть корзину"
            >
                ×
            </button>
        </div>

        <!-- Cart Items -->
        <div class="flex-1 overflow-y-auto px-6 py-5">
            <div id="cart-items" class="space-y-4">
                {% for item in cart_items %}
                    {% include 'cart/cart_item.html' %}
                {% empty %}
                    <div class="flex h-full flex-col items-center justify-center rounded-3xl border border-dashed border-accent-soft/80 bg-white/70 px-6 py-12 text-center text-ink-muted">
                        <p class="text-lg font-semibold text-ink">Корзина пуста</p>
                        <p class="mt-2 text-sm">Добавьте издания из каталога, чтобы продолжить оформление.</p>
                        <a
                            href="{% url 'main:catalog_all' %}"
                            class="mt-6 inline-flex items-center gap-2 rounded-xl border border-accent px-5 py-2 text-sm font-semibold text-ink transition hover:bg-accent-soft"
                            onclick="hideCartModal()"
                        >
                            <span>Перейти в каталог</span>
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Cart Footer -->
        <div id="cart-summary" class="border-t border-accent-soft/60 bg-white/95 px-6 py-6">
            {% if cart_items %}
                {% include 'cart/cart_summary.html' %}
            {% else %}
                <p class="text-sm text-ink-muted">Добавьте товары, чтобы увидеть итоговую сумму.</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Cart Overlay -->
<div onclick="hideCartModal()" id="cart-overlay" class="fixed inset-0 z-40 bg-black/50 transition-all duration-300"></div>

<style>

    #cart-overlay {
        opacity: 0;
        visibility: hidden;
    }
    #cart-overlay.open {
        opacity: 1;
        visibility: visible;
    }
    #cart-overlay.closed {
        opacity: 0;
        visibility: hidden;
    }
</style>

<script>
    function showCartModal() {
        const modal = document.getElementById('cart-modal');
        const overlay = document.getElementById('cart-overlay');
        if (modal && overlay) {
            modal.classList.remove('closed');
            modal.classList.add('open');
            overlay.classList.remove('closed');
            overlay.classList.add('open');
            console.log('Cart modal opened');
        } else {
            console.error('Cart modal or overlay not found');
        }
    }

    function hideCartModal() {
        const modal = document.getElementById('cart-modal');
        const overlay = document.getElementById('cart-overlay');
        if (modal && overlay) {
            modal.classList.remove('open');
            modal.classList.add('closed');
            overlay.classList.remove('open');
            overlay.classList.add('closed');
            console.log('Cart modal closed');
            setTimeout(() => {
                const container = document.getElementById('cart-container');
                if (container) {
                    container.innerHTML = '';
                }
            }, 300);
        } else {
            console.error('Cart modal or overlay not found');
        }
    }

    showCartModal();
    if (typeof updateHeaderCartCount === 'function') {
        updateHeaderCartCount({{ cart.total_items }});
    }
</script>
